# 房间图片获取说明

## 🔄 图片获取方式更新

现在房型图片已经改为**从数据库动态获取**，而不是静态文件映射。

## 📊 工作原理

### 1. 数据获取流程
```
小程序启动 → 调用 /api/rooms → 获取房间列表 → 提取房型图片信息 → 建立房型映射
```

### 2. 图片来源
- **主要来源**: 数据库中 `rooms` 表的 `image` 字段
- **备选方案**: 如果数据库中没有图片，使用占位符

### 3. 代码实现
```javascript
// 获取房间信息并建立房型映射
loadRoomTypeInfo: function() {
  api.getRooms().then(res => {
    const roomTypeMap = {}
    rooms.forEach(room => {
      if (room.type && !roomTypeMap[room.type]) {
        roomTypeMap[room.type] = {
          image: room.image || '',  // 数据库中的图片URL
          description: room.description || '',
          price: room.price || 0
        }
      }
    })
    this.setData({ roomTypeMap })
  })
}

// 获取房型图片
getRoomTypeImage: function(roomType) {
  const roomInfo = this.data.roomTypeMap[roomType]
  if (roomInfo && roomInfo.image) {
    // 处理相对路径 → 完整URL
    if (roomInfo.image.startsWith('/')) {
      return `http://localhost:3000${roomInfo.image}`
    }
    return roomInfo.image
  }
  return '/images/room-placeholder.png'  // 默认占位符
}
```

## 🗄️ 数据库房间图片管理

### 后端图片存储
1. **上传路径**: `/uploads/rooms/`
2. **数据库存储**: 相对路径 `/uploads/rooms/filename.jpg`
3. **前端访问**: `http://localhost:3000/uploads/rooms/filename.jpg`

### 添加房间图片的方法
```sql
-- 更新房间图片
UPDATE rooms SET image = '/uploads/rooms/double-room-1.jpg' WHERE type = '双人房' LIMIT 1;
UPDATE rooms SET image = '/uploads/rooms/suite-1.jpg' WHERE type = '套房' LIMIT 1;
UPDATE rooms SET image = '/uploads/rooms/family-1.jpg' WHERE type = '家庭房' LIMIT 1;
```

## 🎯 优势

### 相比静态图片映射的优势
- ✅ **动态管理**: 可以通过后台管理系统随时更换图片
- ✅ **数据一致性**: 与房间列表页面使用相同的图片源
- ✅ **灵活性**: 支持不同房间使用不同图片
- ✅ **可扩展性**: 新增房型时自动支持图片显示

### 容错机制
- 📱 **图片加载失败**: 自动使用占位符
- 🔄 **数据获取失败**: 设置空映射避免报错
- 📋 **日志记录**: 详细记录获取过程便于调试

## 📋 当前状态

- ✅ **数据库集成**: 已从数据库获取房型图片
- ✅ **动态映射**: 已建立房型→图片的动态映射
- ✅ **错误处理**: 已添加图片加载失败的处理
- ✅ **路径处理**: 已处理相对路径→完整URL的转换

## 🚀 下一步

如果要完善图片显示效果：

1. **检查数据库**: 确认 `rooms` 表中有 `image` 字段且有数据
2. **上传图片**: 通过后台管理系统上传房型图片
3. **测试效果**: 在小程序中验证图片正常显示

这样就实现了与房间列表页面一致的图片管理方式！