<!-- pages/profile/profile.wxml -->
<view class="container">
  <!-- 用户头像区域 -->
  <view class="profile-header">
    <view class="avatar-section">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.svg'}}" mode="aspectFill"></image>
      <view class="user-basic">
        <text class="nickname">{{userInfo.nickName || '未登录'}}</text>
        <text class="phone">{{userInfo.phone || '请完善手机号'}}</text>
      </view>
      <view class="complete-status">
        <text class="status-text {{isProfileComplete ? 'complete' : 'incomplete'}}">
          {{isProfileComplete ? '信息完整' : '待完善'}}
        </text>
      </view>
    </view>
  </view>

  <!-- 个人信息表单 -->
  <view class="form-section">
    <view class="section-title">个人信息</view>
    
    <!-- 真实姓名 -->
    <view class="form-item">
      <text class="label">真实姓名</text>
      <input 
        class="input {{userInfo.realName ? 'filled' : ''}}"
        type="text"
        placeholder="请输入真实姓名"
        value="{{userInfo.realName || ''}}"
        bindinput="onRealNameInput"
        maxlength="20"
      />
      <view class="status-icon" wx:if="{{userInfo.realName}}">✅</view>
    </view>

    <!-- 手机号 -->
    <view class="form-item">
      <text class="label">手机号码</text>
      <input 
        class="input {{userInfo.phone ? 'filled' : ''}}"
        type="number"
        placeholder="请输入手机号"
        value="{{userInfo.phone || ''}}"
        bindinput="onPhoneInput"
        maxlength="11"
      />
      <view class="status-icon" wx:if="{{userInfo.phone}}">✅</view>
    </view>

    <!-- 身份证号 -->
    <view class="form-item">
      <text class="label">身份证号</text>
      <input 
        class="input {{userInfo.idCard ? 'filled' : ''}}"
        type="idcard"
        placeholder="请输入身份证号"
        value="{{userInfo.idCard || ''}}"
        bindinput="onIdCardInput"
        maxlength="18"
      />
      <view class="status-icon" wx:if="{{userInfo.idCard}}">✅</view>
    </view>

    <!-- 性别 -->
    <view class="form-item">
      <text class="label">性别</text>
      <picker 
        mode="selector" 
        range="{{genderOptions}}" 
        range-key="label"
        value="{{genderIndex}}"
        bindchange="onGenderChange">
        <view class="picker {{userInfo.gender ? 'filled' : ''}}">
          {{userInfo.gender || '请选择性别'}}
        </view>
      </picker>
      <view class="status-icon" wx:if="{{userInfo.gender}}">✅</view>
    </view>

    <!-- 年龄 -->
    <view class="form-item">
      <text class="label">年龄</text>
      <input 
        class="input {{userInfo.age ? 'filled' : ''}}"
        type="number"
        placeholder="请输入年龄"
        value="{{userInfo.age || ''}}"
        bindinput="onAgeInput"
        maxlength="3"
      />
      <view class="status-icon" wx:if="{{userInfo.age}}">✅</view>
    </view>

    <!-- 邮箱 -->
    <view class="form-item">
      <text class="label">邮箱地址</text>
      <input 
        class="input {{userInfo.email ? 'filled' : ''}}"
        type="text"
        placeholder="请输入邮箱地址"
        value="{{userInfo.email || ''}}"
        bindinput="onEmailInput"
      />
      <view class="status-icon" wx:if="{{userInfo.email}}">✅</view>
    </view>
  </view>

  <!-- 登录状态区域 -->
  <view class="login-section" wx:if="{{!userInfo || !userInfo.nickName}}">
    <view class="login-prompt">
      <view class="prompt-icon">🔐</view>
      <text class="prompt-title">请先完成微信登录</text>
      <text class="prompt-desc">登录后可以保存和同步您的个人信息</text>
      <button class="login-btn" bindtap="doLogin">立即登录</button>
    </view>
  </view>

  <!-- 操作按钮区域 -->
  <view class="action-section" wx:if="{{userInfo && userInfo.nickName}}">
    <button 
      class="save-btn {{hasChanges ? 'active' : ''}}" 
      bindtap="saveProfile"
      disabled="{{!hasChanges || saving}}"
    >
      <view class="btn-icon">💾</view>
      <view class="btn-text">{{saving ? '保存中...' : (hasChanges ? '保存更改' : '暂无更改')}}</view>
    </button>
    
    <button class="edit-btn" bindtap="enableEdit">
      <view class="btn-icon">✏️</view>
      <view class="btn-text">修改信息</view>
    </button>
    
    <button class="logout-btn" bindtap="doLogout">
      <view class="btn-icon">🚪</view>
      <view class="btn-text">退出登录</view>
    </button>
  </view>

  <!-- 完成度提示 -->
  <view class="completion-tip" wx:if="{{userInfo && userInfo.nickName && !isProfileComplete}}">
    <view class="tip-card">
      <view class="tip-icon">💡</view>
      <view class="tip-content">
        <text class="tip-title">完善个人信息</text>
        <text class="tip-desc">完善所有信息后即可开始预订酒店服务</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{completionPercentage}}%"></view>
      </view>
      <text class="progress-text">完成度: {{completionPercentage}}%</text>
    </view>
  </view>
</view>